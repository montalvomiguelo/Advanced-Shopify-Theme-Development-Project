<header id="header">
  <div class="row">
    <div class="col-sm-6">
      <h1>{{ product.title | escape }}</h1>
      {% comment %}
        Get first variant
      {% endcomment %}
      {% assign current_variant = product.selected_or_first_available_variant %}
      <p id="product-price" class="product-price">
        {% if product.compare_at_price > product.price %}
          {{ current_variant.price | money }} <s>{{ current_variant.compare_at_price | money }}</s>
        {% else %}
          {{ current_variant.price | money }}
        {% endif %}
      </p>
    </div>
  </div>
</header>

<section id="product">
  <div class="row">
    <div class="col-sm-3 col-md-5">
      {% assign featured_image = current_variant.featured_image | default: product.featured_image %}
      <img src="{{ featured_image | product_img_url: 'large' }}" class="img-responsive" id="product-image" alt="{{ featured_image.alt | escape }}" />
    </div>

    <div class="col-sm-9 col-md-7">
      {% if product.images.size > 1 %}
        <div id="product-thumbnails" class="row">
          {% for image in product.images %}
            <div class="col-sm-3">
              <a href="{{ image.src | img_url: 'large' }}">
                <img class="img-responsive" src="{{ image.src | img_url: 'compact' }}" alt="{{ image.alt | escape }}">
              </a>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      <p>
        {{ product.description }}
      </p>

      <form action="/cart/add" method="post" role="form">
        <select id="product-select" name="id">
          {% for variant in product.variants %}
          <option value="{{ variant.id }}"{% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %}>{{ variant.title }} - {{ variant.price | money }}</option>
          {% endfor %}
        </select>

        <!-- Variant swatches. -->
        {% if product.available and product.variants.size > 1 %}
          {% for option in product.options %}
            {% include 'swatch' with option %}
          {% endfor %}
        {% endif %}

        <button type="submit" id="add" class="button">Add to cart</button>
      </form>
    </div>
  </div>
</section>

<script>
  jQuery(function($) {

    var selectCallback = function(variant, selector) {

      // BEGIN SWATCHES
      var form = jQuery('#' + selector.domIdPrefix).closest('form');
      var selectedValues = selector.selectedValues();
      var length = selectedValues.length;
      for (var i = 0; i < length; i++) {
        // Add 'selected' class to selected swatch
        var $swatch = form.find('.swatch[data-change-option="' + i + '"]').filter('[data-change-value="' + selectedValues[i] +'"]');
        if ($swatch.length) {
          $swatch.siblings().removeClass('selected');
          $swatch.addClass('selected');
        }
      }
      // END SWATCHES

      if (variant) {

        if (variant.available) {
          // Available, enable the submit button, change text
          $('#add').removeClass('disabled').prop('disabled', false).text('Add to cart');
        } else {
          // Sold out, disable the submit button, change text
          $('#add').addClass('disabled').prop('disabled', true).text('Sold out');
        }

        // Regardless of stock, update the product price and compare at price
        if (variant.compare_at_price > variant.price) {
          $('#product-price').html( Shopify.formatMoney(variant.price, "{{ shop.money_format }}") + '&nbsp; <s>' + Shopify.formatMoney(variant.compare_at_price, "{{ shop.money_format }}") + '</s>' );
        } else {
          $('#product-price').html( Shopify.formatMoney(variant.price, "{{ shop.money_format}}") );
        }

        // Update variant image, if one is set
        if (variant.featured_image) {
          var newImg = variant.featured_image;
          var el = $('#product-image')[0];
          Shopify.Image.switchImage(newImg, el, switchImage);
        }

      } else {
        // Variant doesn't exist, disable submit button, change text
        $('#product-price').empty();
        jQuery('#add').addClass('disabled').prop('disabled', true).text('Unavailable');
      }

    };

    new Shopify.OptionSelectors('product-select', {
      product: {{ product | json }},
      onVariantSelected: selectCallback,
      enableHistoryState: true
    });

  // Add label if only one product option and it isn't 'Title'.
  {% if product.options.size == 1 and product.options.first != 'Title' %}
    $('.selector-wrapper:eq(0)').prepend('<label>{{ product.options.first }}</label>');
  {% endif %}

  // Hide selectors if we only have 1 variant and its title contains 'Default'.
  {% if product.variants.size == 1 and product.variants.first.title contains 'Default' %}
    $('.selector-wrapper').hide();
  {% endif %}

  });
</script>
